<!DOCTYPE HTML>
<html>
<head>
<title>pixi.js example 1</title>
<style>
body {
margin: 0;
padding: 0;
background-color: #000000;
}
</style>
<script src="keydrown.min.js"></script>
<script src="pixi.js"></script>
<script src="stats.min.js"></script>
</head>
<body>
<script>
var stats = new Stats();
stats.setMode(0);
stats.domElement.style.position = 'absolute';
stats.domElement.style.left = '0px';
stats.domElement.style.top = '0px';
document.body.appendChild( stats.domElement );

var h = window.innerHeight;
var w = window.innerWidth;
var NUM_STARS = 50;
var MAX_VEL = 10;
var stage = new PIXI.Stage(0x000000);
var renderer = PIXI.autoDetectRenderer(w, h);
document.body.appendChild(renderer.view);

var playerTexture = PIXI.Texture.fromImage("player.png");
var playerLeftTexture = PIXI.Texture.fromImage("playerLeft.png");
var playerRightTexture = PIXI.Texture.fromImage("playerRight.png");
var starTexture = PIXI.Texture.fromImage("starSmall.png");
var meteorTexture = PIXI.Texture.fromImage("meteorBig.png");

var player = new PIXI.Sprite(playerTexture);
player.velocity = 0;
player.angle = 0;
player.anchor.x = 0.5;
player.anchor.y = 0.5;

var player2 = new PIXI.Sprite(playerTexture);
player2.velocity = 0;
player2.angle = 0;
player2.anchor.x = 0.5;
player2.anchor.y = 0.5;

var stars = new PIXI.DisplayObjectContainer();
var world = new PIXI.DisplayObjectContainer();
for(var i = 0; i < NUM_STARS; i++) {
    var star = new PIXI.Sprite(starTexture);
    star.position.x = Math.floor(Math.random() * w);
    star.position.y = Math.floor(Math.random() * h);
    star.rotation = Math.random() * 2 * Math.PI;
    var scale = 0.4 + Math.random() * 0.8;
    star.rscale = new PIXI.Point(scale, scale);
    stars.addChild(star);
}
var meteor = new PIXI.Sprite(meteorTexture);
meteor.anchor.x = 0.5;
meteor.anchor.y = 0.5;

var meteor2 = new PIXI.Sprite(meteorTexture);
meteor2.anchor.x = 0.5;
meteor2.anchor.y = 0.5;
meteor2.position.x = 200;
meteor2.position.y = 200;

var meteor3 = new PIXI.Sprite(meteorTexture);
meteor3.anchor.x = 0.5;
meteor3.anchor.y = 0.5;
meteor3.position.x = -200;
meteor3.position.y = -200;

world.position.x = w / 2;
world.position.y = h / 2;
world.addChild(meteor);
world.addChild(meteor2);
world.addChild(meteor3);
world.addChild(player);
world.addChild(player2);

stage.addChild(stars);
stage.addChild(world);

function draw() {
    stats.begin();
    kd.tick();

    if (player.velocity > MAX_VEL) {
        player.velocity = MAX_VEL;
    } else if (player.velocity < -MAX_VEL) {
        player.velocity = -MAX_VEL;
    }
    player.rotation = player.angle + Math.PI / 2;

    var move = new PIXI.Point(player.velocity * Math.cos(player.angle), player.velocity * Math.sin(player.angle));
    player.position.x += move.x;
    player.position.y += move.y;

    if (player2.velocity > MAX_VEL) {
        player2.velocity = MAX_VEL;
    } else if (player2.velocity < -MAX_VEL) {
        player2.velocity = -MAX_VEL;
    }
    player2.rotation = player2.angle + Math.PI / 2;

    var move2 = new PIXI.Point(player2.velocity * Math.cos(player2.angle), player2.velocity * Math.sin(player2.angle));
    player2.position.x += move2.x;
    player2.position.y += move2.y;

    move.x += move2.x;
    move.y += move2.y;

    var scalex = 1;
    var scaley = 1;
    var absx = Math.abs(player.position.x) + 100 ;
    var absy = Math.abs(player.position.y) + 100 ;
    if (absx > w / 2 ) {
        scalex = (w/2) / absx;
    }
    if (absy > h / 2 ) {
        scaley = (h/2) / absy;
    }

    var scalex2 = 1;
    var scaley2 = 1;
    var absx2 = Math.abs(player2.position.x) + 100 ;
    var absy2 = Math.abs(player2.position.y) + 100 ;
    if (absx2 > w / 2 ) {
        scalex2 = (w/2) / absx2;
    }
    if (absy2 > h / 2 ) {
        scaley2 = (h/2) / absy2;
    }

    var scale = Math.min(scalex, scaley, scalex2, scaley2);
    world.scale.x = scale;
    world.scale.y = scale;
    for(var i = 0; i < stars.children.length; i++) {
        var star = stars.getChildAt(i);

        star.scale.x = star.rscale.x * scale;
        star.scale.y = star.rscale.y * scale;

        star.position.x += (0.2 * star.scale.x) * -move.x;
        star.position.y += (0.2 * star.scale.y) * -move.y;
        if(star.position.x > w) {
            star.position.y = Math.random() * h;
            star.position.x = 0;
        } else if (star.position.x < 0) {
            star.position.y = Math.random() * h;
            star.position.x = w;
        }
        if(star.position.y > h) {
            star.position.y = 0;
            star.position.x = Math.random() * w;
        } else if (star.position.y < 0) {
            star.position.y = h;
            star.position.x = Math.random() * w;
        }
    }

    requestAnimFrame(draw);
    renderer.render(stage);
    stats.end();
}
requestAnimFrame( draw );

kd.W.down(moveUp);
kd.S.down(moveDown);
kd.A.down(moveLeft);
kd.D.down(moveRight);
kd.A.up(releaseDirection);
kd.D.up(releaseDirection);
function moveUp(e) {
    player.velocity += 0.1;
}
function moveDown(e) {
    if (player.velocity > 0) {
        player.velocity -= 1;
    } else {
        player.velocity -= 0.05;
    }
}
function moveRight(e) {
    player.setTexture(playerRightTexture);
    player.angle += 0.1;
}
function moveLeft(e) {
    player.setTexture(playerLeftTexture);
    player.angle -= 0.1;
}
function releaseDirection(e) {
    player.setTexture(playerTexture);
}

kd.UP.down(moveUp2);
kd.DOWN.down(moveDown2);
kd.LEFT.down(moveLeft2);
kd.RIGHT.down(moveRight2);
kd.LEFT.up(releaseDirection2);
kd.RIGHT.up(releaseDirection2);
function moveUp2(e) {
    player2.velocity += 0.1;
}
function moveDown2(e) {
    if (player2.velocity > 0) {
        player2.velocity -= 1;
    } else {
        player2.velocity -= 0.05;
    }
}
function moveRight2(e) {
    player2.setTexture(playerRightTexture);
    player2.angle += 0.1;
}
function moveLeft2(e) {
    player2.setTexture(playerLeftTexture);
    player2.angle -= 0.1;
}
function releaseDirection2(e) {
    player2.setTexture(playerTexture);
}

function resize()
{
    w = $(window).width() - 16;
    h = $(window).height() - 16;

    renderer.resize(w, h);
}
</script>
</body>
</html>
